<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Gun Violence</title>
		
		<!--AFrame-->
		<script src="https://rawgit.com/aframevr/aframe/master/dist/aframe.min.js"></script>
		<!--Stylesheet-->
		<link rel="stylesheet" type="text/css" href="css/stylesheet.css">
		<!--JQuery-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<!--SocketIO-->
		<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
		<!--K-Frame-->
		<script src="https://rawgit.com/ngokevin/kframe/master/dist/kframe.min.js"></script>
	</head>
	<body>
		<!--div id="loadingblocker"></div-->
		<div class="topbar">
			<div id="location">
				<span>City, State</span>
			</div>
			<div id="topdata">
				<span id="incidents">0 incidents,</span>
				<span id="injuries">0 injuries,</span>
				<span id="deaths">0 deaths,</span>
				from guns in the last 72 hours
			</div>
			<div id="info"><a href="about.html">About</a></div>
		</div>
		<div class="vrwrapper">
			<div id="left">
				<ul id="llist">
					<li class="lemptyli"></li>
				</ul> 
			</div>
			<a-scene embedded>
				<a-assets>
					<a-asset-item id="gun-dae" src="assets/gunColladaVersion.dae"></a-asset-item>
					<a-asset-item id="bullet-dae" src="assets/Bullet.dae"></a-asset-item>
				</a-assets>
				<!--Gun-->
				<a-collada-model id="gun"
									collada-model="#gun-dae"
									position="0 0 0"
									rotation="-90 -90 178"
									scale="0.10 0.10 0.10"		 
									material="src: url(assets/handgun-texture.png)">
										<a-animation begin="shot"
												attribute="rotation"
												from="-90 -90 178"
												to="-60 -90 178"
												dur="500"
												easing="ease-out-back"
												direction="alternate"
												repeat="1"></a-animation>
				</a-collada-model>
				<a-entity id="PutBulletsHere">
					
				</a-entity>
				<a-sky color="#6a2a28"></a-sky>
				<a-camera position="0 -1.6 1" look-controls="enabled: false" wasd-controls="enabled: false"></a-camera>
			</a-scene>
			<div id="right">
				<ul id="rlist">
					
				</ul> 
			</div>
		</div>
		<!--audio id="gunshot">
			<source src="assets/Gunshot.mp3"></source>
		</audio-->
		<script type="text/javascript" src="js/Generate.js"></script>
		<script>
			/*Variable*/
			var socket = io.connect("http://6310.lmc.gatech.edu:6010");
			//var socket = io.connect(); /*Connecting to server causes sever to start parsing gun data.*/
			var useStaticLocation = true; /*Set this to true to test multiple locations. I only use city, aadministrativeLevels.level1long and administrativeLevels.level2long so you only need to change those*/
			var sound = document.getElementById("gunshot"); 
			var debugStaticLocation = [
				{ 
				formattedAddress: '650 West Aldine Ave, Chicago, IL 60657, USA',
    		latitude: 41.942166,
    		longitude: -87.646414,
    		extra:
     		{  googlePlaceId: 'ChIJ8yDAucAF9YgRYFcQmqSztu0',
					 confidence: 1,
					 premise: null,
					 subpremise: null,
					 neighborhood: 'Boystown',
					 establishment: null },
				administrativeLevels:
     		{  level2long: 'Cook County',
					 level2short: 'Cook County',
					 level1long: 'Illinois',
					 level1short: 'IL' },
				streetNumber: '650',
				streetName: 'West Aldine Ave',
				city: 'Chicago',
				country: 'United States',
				countryCode: 'US',
				zipcode: '60657',
				provider: 'google' } 
			];
			/**/
			
			/*ON DOCUMENT LOAD CODE*/
			$(document).ready(function() {
				WaitToParseData();
				WaitToDisplayData();
			});
			function loading() {
				if (loadingDone) { 
					fadeout();
				} else {
					setTimeout( loading, 250 );
				}
			}
			function fadeout(){
				/*while(bulletIterator > 0) {
					setTimeout("sound.play();", 200000);
					bulletIterator--;
					console.log("loopin'");
				}*/
				$( "#loadingblocker" ).fadeOut( "slow" );
			}
			/*GUN INCIDENT DATA CODE*/
			socket.on('returndata', function(data) { /* This is called when the JSON data is processed and passed by the server*/
				//console.log(data);
				getGunData(data);
  		});
			/**/
			
			
			
			
			/*GELOCATION CODE*/
			if (useStaticLocation) {
				getLocationData(debugStaticLocation[0]);
			}
			else if (!navigator.geolocation) { /*Checks if the browser can get is location on load*/
				console.log("Geolocation is not supported by your browser");
    	}
			else { /*If it can, the navigator starts the process of getting the player's location*/
				navigator.geolocation.getCurrentPosition(success, error);
			}
			function success(position) { /*If sucessful, print that out to the console and pass that data to the server*/
					var lat = position.coords.latitude;
					var lng = position.coords.longitude;
					console.log('Latitude is ' + lat + ' Longitude is ' + lng)
					socket.emit('passLoc', {
						latitude: lat,
						longitude: lng
					});
			};
			function error(error) { /*If Unsucessful, tell us why.*/
					switch(error.code) {
					case error.PERMISSION_DENIED:
							//output.innerHTML = "User denied the request for Geolocation."
							console.log("User denied the request for Geolocation.");
							break;
					case error.POSITION_UNAVAILABLE:
							//output.innerHTML = "Location information is unavailable."
							console.log("Location information is unavailable.");
							break;
					case error.TIMEOUT:
							//output.innerHTML = "The request to get user location timed out."
							console.log("The request to get user location timed out.");
							break;
					case error.UNKNOWN_ERROR:
							//output.innerHTML = "An unknown error occurred."
							console.log("An unknown error occurred.");
							break;
					}
			};
			socket.on('passbackLoc', function(results) { /*This is called when the users location is returned from Google Maps*/
				getLocationData(results.results[0]);
  		});
			loading();
			/**/
		</script>
	</body>
</html>
